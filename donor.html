<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Donor Registration Form</title>

<style>
body {
    background-color: #f4f4f4;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
}
.container {
    background: white;
    padding: 30px;
    border-radius: 10px;
    width: 400px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
}
h2 {
    text-align: center;
    margin-bottom: 20px;
}
input, select, button {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
}
button {
    margin-top: 15px;
    background: #4CAF50;
    color: white;
    border: none;
    cursor: pointer;
}
button:hover {
    background: #45a049;
}
.terms {
    margin-top: 10px;
    font-size: 14px;
}
#message {
    display: none;
    text-align: center;
    margin-top: 20px;
}
</style>

</head>

<body>

<div class="container">

<h2 id="formTitle">Donor Registration Form</h2>

<form id="donorForm">
    <label>Name:</label>
    <input type="text" id="name" required>

    <label>Phone Number:</label>
    <input type="text" id="phone" required>

    <button type="button" onclick="sendOTP()">Send OTP</button>

    <label>Enter OTP:</label>
    <input type="text" id="otp" required>

    <label>Event Date:</label>
    <input type="date" id="eventDate" required onchange="validateDate()">

    <label>Reason for Donation:</label>
    <select id="reason" required>
        <option value="">Select</option>
        <option value="Fresh Food">Fresh Food</option>
        <option value="Leftover Food">Leftover Food</option>
    </select>

    <label>Food Details:</label>
    <input type="text" id="foodDetails" required>

    <div class="terms">
        <input type="checkbox" id="terms" onclick="redirectToTerms()"> I Accept Terms and Conditions
    </div>

    <div id="locationSection" style="display:none;">
        <label>Enter Your Location:</label>
        <input type="text" id="location" required oninput="suggestOrphanage()">

        <label>Nearby Orphanage:</label>
        <input type="text" id="orphanage" readonly>
    </div>

    <button type="button" id="confirmBtn" style="display:none;" onclick="submitForm()">Confirm & Register</button>
</form>

<div id="message"></div>

</div>

<script>
let sessionId = "";

window.onload = function() {
    const params = new URLSearchParams(window.location.search);
    if (params.get('agreed') === 'true') {
        document.getElementById('locationSection').style.display = 'block';
    }
}

function redirectToTerms(){
    window.location.href = "terms.html";
}

function sendOTP() {
    const phone = document.getElementById('phone').value;
    if(phone.length != 10){
        alert('Enter Valid 10-digit Mobile Number');
        return;
    }

    fetch(`https://2factor.in/API/V1/YOUR_API_KEY/SMS/${phone}/AUTOGEN`)
    .then(response => response.json())
    .then(data => {
        if(data.Status == "Success"){
            sessionId = data.Details;
            alert('OTP Sent Successfully');
        } else {
            alert('Error Sending OTP');
        }
    });
}

function validateDate() {
    const eventDate = document.getElementById('eventDate').value;
    const today = new Date().toISOString().split('T')[0];
    if (eventDate !== today) {
        document.getElementById('donorForm').style.display = 'none';
        document.getElementById('formTitle').style.display = 'none';
        document.getElementById('message').style.display = 'block';
        document.getElementById('message').innerHTML = "You are not eligible to donate as event date does not match with today's date!";
    }
}

function suggestOrphanage(){
    const location = document.getElementById('location').value.toLowerCase();
    let orphanage = "";

    if(location.includes("hyderabad")){
        orphanage = "Hope Orphanage - Hyderabad";
    } else if(location.includes("secunderabad")){
        orphanage = "Care Home - Secunderabad";
    } else {
        orphanage = "Helping Hands Orphanage - Nearby";
    }

    document.getElementById('orphanage').value = orphanage;
    document.getElementById('confirmBtn').style.display = 'block';
}

function submitForm() {
    const otp = document.getElementById('otp').value;
    if (otp.length != 4) {
        alert('Enter Valid OTP');
        return;
    }

    fetch(`https://2factor.in/API/V1/YOUR_API_KEY/SMS/VERIFY/${sessionId}/${otp}`)
    .then(response => response.json())
    .then(data => {
        if (data.Status == "Success") {
            document.getElementById('donorForm').style.display = 'none';
            document.getElementById('formTitle').style.display = 'none';
            document.getElementById('message').style.display = 'block';
            document.getElementById('message').innerHTML = `
                <h3>ðŸŽ‰ Registration & Donation Successful! ðŸŽ‰</h3>
                <p>Thank you for your valuable contribution!</p>
            `;
        } else {
            alert('Incorrect OTP');
        }
    });
}
</script>

</body>
</html>


